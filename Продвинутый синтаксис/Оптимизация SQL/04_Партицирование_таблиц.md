# Партицирование таблиц

**Партицирование** — это разделение большой таблицы на несколько таблиц меньшего размера (партиции) по какому-то критерию. Ещё этот метод называют «партиционированием» или «секционированием».

**Преимущества партицирования**:  
- Прицельный поиск вместо полного сканирования: Система сразу обращается к нужным сегментам (партициям), избегая медленного перебора всей таблицы, что ускоряет выполнение запросов.  
- Быстрые массовые операции: Загрузка или удаление данных происходит практически мгновенно за счет добавления или отключения целых партиций, минуя трудоемкую построчную обработку.  
- Эффективное архивное хранение: "Холодные" данные можно вынести на медленные диски, оптимизируя затраты на хранение без перегрузки основного сервера.  

*Партицирование — это инструмент оптимизации «тяжелых» таблиц, а не панацея. Его внедрение сопряжено с накладными расходами на создание и обслуживание логических разделов. Эти затраты окупаются лишь в случае действительно больших объемов данных.*

## Виды партицирования 

В PostgreSQL реализовано два принципиально разных подхода к разделению таблиц:  

- **Декларативное** (Declarative) партицирование — нативный и самый производительный механизм СУБД. Его ключевое преимущество — полная автоматизация: система самостоятельно управляет партициями «под капотом», что значительно снижает нагрузку на разработчика. Существенным ограничением является невозможность преобразовать существующую таблицу напрямую — требуется создать новую, изначально объявленную как партиционированная.  

- Партицирование **через наследование** (Table Inheritance) — классический, более гибкий метод. Он позволяет разделить уже имеющуюся таблицу и поддерживает сложные сценарии с множественным наследованием. Гибкость достигается за счет ручного управления: все операции по созданию партиций, назначению правил или триггеров для маршрутизации данных ложатся на программиста.  

## Стратегии (методы) партицирования  

- **Партицирование по диапазону (RANGE)**:  
Данные распределяются на основе интервалов значений ключа — например, по датам или числовым идентификаторам. Важно понимать соглашение о границах: нижняя граница диапазона включается в партицию, а верхняя — исключается. Таким образом, при определении партиций FROM (1) TO (10) и FROM (10) TO (20), строки со значением ключа 9 попадут в первую партицию, а со значением 10 — уже во вторую. Это исключает неоднозначность и дублирование данных.  

- **Партицирование по списку (LIST)**:  
Стратегия подразумевает явное сопоставление конкретных значений ключа определённой партиции. Например, можно создать партицию для документов, где столбец region принимает значения ('MSC', 'SPB'), и отдельную партицию для региона ('EKB'). Это идеально для категориальных данных с известным и ограниченным набором значений.  

- **Партицирование по хешу (HASH)**:  
Распределение данных происходит не по семантике, а по результату детерминированной хеш-функции, применяемой к ключу. При создании задаётся количество партиций (модуль). Строка попадает в партицию, чей номер соответствует остатку от деления хеш-значения ключа на этот модуль. Например, при партицировании по user_id с модулем 4, все строки будут равномерно (насколько это позволяет хеш-функция) распределены между партициями с остатками 0, 1, 2 и 3. Цель — обеспечить равномерную нагрузку.  

Физически данные хранятся не в основной таблице, а в её партициях — это обычные таблицы, дублирующие её структуру вместе с индексами. Основная таблица выступает лишь «картой» или «роутером», который знает, какая часть данных в какой физической таблице расположена. Все запросы автоматически перенаправляются в соответствующие партиции.  

## Создание партицированной таблицы

Процесс состоит из двух ключевых этапов:  

### 1. Объявление родительской (виртуальной) таблицы

При создании указывается стратегия разделения данных с помощью конструкции PARTITION BY:  
- `PARTITION BY RANGE (поле)` — для диапазонов (дат, чисел)  
- `PARTITION BY LIST (поле)` — для категорий (регионы, типы)  
- `PARTITION BY HASH (поле)` — для равномерного распределения  

### 2. Создание физических партиций
